<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=on" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>问题详情</title>
    <link rel="stylesheet" href="../css/reset.css">
    <script src="../js/response.js"></script>
    <style>
        body{background: #f9f9f9}
        header{
            padding: 0.5rem 0.24rem 0.4rem; 
            background: #ffffff;
        }
        header h3{
            font-size: 0.36rem;
            color: #222222;
            line-height: 1.5;
            padding-right: 0.22rem;
        }
        header p{
            font-size: 0.3rem;
            color: #999999;
            line-height: 1.5;
            margin: 0.3rem 0;
            padding-right: 0.22rem;
        }
        .tag{
            overflow: hidden;
            margin-bottom: 0.4rem
        }
        .tag span{
            padding: 0.1rem 0.1rem;
            font-size: 0.2rem;
            color: #999999;
            background: #f2f2f2 ;
            float: left;
            margin-right: 0.1rem;
            border-radius: 0.1rem;
        }
        .description{
            display: flex;
            border-top: 1px solid #e6e6e6;
            padding:0.4rem 0 0;
            flex-flow: row nowrap;
            justify-content:  center;
            align-items: space-around;
            box-sizing: border-box;
            background: #ffffff;
        }
        .description .two{
            flex: 1.8rem 0 0;
            width: 1.8rem;
            font-size: 0.26rem;
            text-align: center;
        }
        .description .one{
            flex: 1;
            font-size: 0.26rem;
        }
        .star{
            width: 0.3rem;
            height: 0.3rem;
            margin: 0 auto 0.16rem;
        }
        .star img{
            width: 100%;
            height: 100%;
        }
        section{
            margin-top: 0.2rem;
            background: #ffffff;
        }
        .title{
            font-size: 0.26rem;
            color: #999999;
            height: 0.85rem;
            line-height: 0.85rem;
            padding:0 0.25rem;
            border-bottom: 1px solid #e6e6e6;
        }
        .userInfo{
            display: flex;
            flex-flow: row nowrap;
            padding: 0.4rem 0.25rem 0.4rem;
            align-items:center;
        }
        .userInfo .img{
            flex: 0.8rem 0 0;
            width: 0.8rem;
            height: 0.8rem;
            background: url('./imgs/avatar.png') no-repeat center center;
            background-size:cover; 
            border-radius: 50%;
            margin-right: 0.2rem;
        }
        .user{
            flex:1;
            font-size: 0.34rem;
        }
        .user>div:not(:last-child){
            float: right;
            margin-left: 0.6rem; 
        }
        .message,
        .telphone{
            width:0.33rem;
            height: 0.34rem;
        }
        .message img,
        .telphone img{
            display: block;
            width: 100%;
            height: 100%;
        }
        .flag{
            height: 0.4rem;
            line-height: 0.4rem;
            width: 0.95rem;
            text-align: center;
            font-size: 0.22rem;
            border-radius: 0.1rem;
            
        }
        .gray{
            background: #f2f2f2;
            color: #999999;
        }
        .red{
            background: #ffecec;
            color: #ff4343;
        }
        .answers{
            margin: 0  0.25rem 0.4rem; 
            border-bottom: 1px solid #e6e6e6;
        }
        .answersTime{
            font-size: 0.22rem;
            color: #999999;
        }
        .answersTime+p{
            padding: 0 0.24rem 0.5rem 0;
            font-size: 0.3rem;
            line-height: 1.5;
        }
        .answers h4{
            font-size: 0.3rem;
            padding-bottom: 0.4rem;
        }
        
    </style>
</head>
<body>
    <div id="box">
        <header>
            <h3>{{dataDetail.problemTitle}}</h3>
            <p>{{dataDetail.problemDescribe}}</p>
            <div class="tag">
                <span v-for="item in dataDetail.label">{{item}}</span>
                <!-- <span>交易过户</span> -->
            </div>
            <div class="description">
                <div class="one">
                    <div style="margin-bottom:0.16rem">{{dataDetail.memberId}}</div>
                    <div>发布于: {{dataDetail.pubTime|timefilter}}</div>
                </div>
                <div class="two" v-if="addLike" @click="togglelike()">
                    <div class="star"><img src="imgs/star-off.png"></div>
                    <div>取消关注</div> 
                </div>
                <div class="two" v-else @click="togglelike()">
                    <div class="star"><img src="imgs/star-on.png"></div>
                    <div>关注</div>
                </div>
            </div>
        </header>
        <section>
            <div class="title">共{{dataDetail.answerNum}}个回答</div>
            <ul>
                <li v-for="(item,index) in 2">
                    <div class="userInfo">
                        <div class="img"><img :src="item.photo"></div>
                        <div class="user">
                            <div class="message"><a href="sms:15857009524"><img src="imgs/duanxin.png"></a></div>
                            <div class="telphone"><a href="tel:15857009524"><img src="imgs/phone.png"></a></div>
                            <div class="flag gray" v-if=" agreeIndex == index? false : true " @click="toggleAgree(index)">待采纳</div>
                            <div class="flag red" v-else  @click="toggleAgree(index)">已采纳</div>
                            <div class="name">{{dataDetail.consultantName}}</div>
                        </div>
                    </div>
                    <div class="answers">
                        <div class="answersTime">{{dataDetail.answerTime}}</div>
                        <p>{{dataDetail.answerContent}}</p>
                        <h4>希望能帮到您！回答满意请点赞采纳！</h4>
                    </div>
                </li>
            </ul>
        </section>
    </div>
    <script src="../js/response.js"></script>
    <script src="../js/axios.min.js"></script>
    <script src="../js/axiosurl.js"></script>
    <script src="../js/vue.min.js"></script>
    <script>
        var vm = new Vue({
                el: '#box',
                data: {
                    dataDetail: null,
                    urlparams: null,
                    city: '',
                    employeeId: '',
                    token: '',
                    addLike: true,
                    agreeIndex: null
                },
                created() {
                    var url = location.href;
                    // id 列表id
                    // scityname 城市拼音
                    // token 尽量都传过来
                    var url = 'xxxxxxx?id=434&scityname=beihai&token=d2ViX2MxMTE0YzVhLWYwOGEtNDg0OS1iZWM1LTMzZThlOTBmYWM3Ml8w';
                    var urlparams = this.parseUrl(url);
                    console.log(urlparams);

                    this.urlparams = urlparams;
                    this.city = urlparams.scityname;
                    this.employeeId = this.urlparams.id;
                    this.token = this.urlparams.token;
                    this.answersDetialRequest(this.employeeId, this.city);
                },
                filters:{
                    timefilter(val){
                        var d = new Date(val);
                        var time = d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate();
                        return time;
                    }
                },
                methods: {
                    togglelike() {
                        this.addLike = !this.addLike;
                    },
                    toggleAgree(index) {
                        this.agreeIndex = index;
                    },
                    answersDetialRequest(id,city,token) {
                        axios.get(CONSULTANTINFO+"?employeeId="+id,{
                            headers:{
                                'Content-Type': "application/json;charset=UTF-8",
                                'scity': city,
                                'unique-code': token
                            }
                        })
                        .then((res) => {
                            let newData = res.data.data;
                            newData.label = newData.label.split(',');
                            this.dataDetail = newData;
                        })
                    },
                    parseUrl(url) {
                        var urlStr=url.split("?")[1].split("&");
                        var urlparams = {};
                        for( let i=0;i<urlStr.length;i++){
                            var item = urlStr[i].split("=")
                            urlparams[item[0]]=item[1]
                        }
                        return urlparams;
                    }
                }
            })
    </script>
</body>
</html>